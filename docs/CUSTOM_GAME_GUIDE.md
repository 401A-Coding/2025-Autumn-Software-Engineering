# 自定义棋局功能使用指南

## 🎯 功能概述

自定义棋局功能允许你创造独特的象棋玩法，通过修改棋子规则实现各种有趣的变体。

## 📱 使用流程

### 1. 进入规则编辑器

从首页点击 **"⚙️ 规则编辑器"** 按钮进入编辑界面。

### 2. 编辑规则（两步走）

#### 第一步：规则定义页面
- **快速加载预设**：选择标准/超级/现代/疯狂等预设规则
- **选择棋子**：点击左侧棋子按钮选择要修改的棋子
- **选择移动模板**：使用预定义的移动模板快速设置
- **设置限制条件**：勾选跳跃、过河、九宫等限制

#### 第二步：开始对战
- 点击右上角 **"开始对战 →"** 按钮
- 自动跳转到对战页面
- 可随时返回修改规则

## 🎨 移动模板系统

### 智能模板过滤

系统会根据选中的棋子自动显示合适的模板：

- **选中兵时**：只显示兵专用的两个模板（前进、横移）
- **选中其他棋子**：显示所有通用模板，不显示兵专用模板

### 模板列表

| 图标 | 模板名称 | 说明 | 显示条件 |
|------|---------|------|---------|
| 📏 | 直线无限 | 四个直线方向无限移动 | 非兵棋子 |
| ➕ | 直线一格 | 四个直线方向移动一格 | 非兵棋子 |
| ╳ | 斜线无限 | 四个斜线方向无限移动 | 非兵棋子 |
| ✕ | 斜线一格 | 四个斜线方向移动一格 | 非兵棋子 |
| 🐴 | 马的日字 | 走日字，可选蹩腿 | 非兵棋子 |
| 🐘 | 象的田字 | 走田字，可选塞眼 | 非兵棋子 |
| 👑 | 八方一格 | 向八个方向移动一格 | 非兵棋子 |
| 🔫 | 炮移动 | 直线移动不吃子 | 非兵棋子 |
| 💥 | 炮吃子 | 隔子吃 | 非兵棋子 |
| ⬆ | 兵只能前进 | 未过河只能前进 | **仅兵** |
| ↕ | 兵可以横移 | 可以前进和左右 | **仅兵** |

### 模板套用示例

**让车使用马的移动方式：**
1. 选择"车"棋子
2. 点击"🐴 马的日字"模板
3. 车现在走日字了！

**让马可以自由跳跃（取消蹩马腿）：**
1. 选择"马"棋子
2. 取消勾选"🐴 启用蹩马腿规则"
3. 马可以自由移动，不会被阻挡了！

**让象可以过河且不受塞象眼限制：**
1. 选择"象"棋子
2. 勾选"可以过河"
3. 取消勾选"🐘 启用塞象眼规则"
4. 象现在可以自由移动了！

**设置兵的移动方式：**
1. 选择"兵"棋子
2. 只会看到两个模板："⬆ 兵只能前进" 和 "↕ 兵可以横移"
3. 选择你想要的移动方式

## ⚙️ 限制条件

### 通用限制

- **可以跳过其他棋子**：移动时可以跨过其他棋子
- **可以过河**：可以进入对方半场
- **必须待在九宫内**：限制在3x3的九宫区域（仅将/士可用）

### 特殊规则

#### 🐴 马专属：蹩马腿规则
- **说明**：启用后，马在移动时会被阻挡（传统规则）
- **关闭效果**：马可以自由跳跃，不受蹩马腿限制
- **位置**：仅在选中"马"棋子时显示（橙色高亮）

#### 🐘 象专属：塞象眼规则
- **说明**：启用后，象在移动时会被阻挡（传统规则）
- **关闭效果**：象可以自由移动，不受塞象眼限制
- **位置**：仅在选中"象"棋子时显示（蓝色高亮）

### 应用场景

**超级象棋模式：**
- 所有棋子勾选"可以跳跃"
- 象勾选"可以过河"
- 将取消"必须待在九宫内"

**现代简化模式：**
- 马勾选"可以跳过其他棋子"
- 象勾选"可以过河"
- 兵使用"兵可以横移"模板

## 🎮 预设规则说明

### 📋 标准规则
遵循传统中国象棋规则，适合正式对弈。

### ⚡ 超级象棋
- 将帅可以出九宫
- 象可以过河
- 马可以蹩腿
- 炮可以跳跃
- 兵从开局就可以横移

### 🎯 现代象棋
- 简化规则，适合新手
- 象可以过河
- 马可以蹩腿
- 兵可以全向移动

### 🔥 疯狂象棋
- 极限模式，所有限制解除
- 将帅可以八方移动
- 所有棋子都可以跳跃
- 兵可以八方移动

## 💡 创意玩法推荐

### 1. 超级马模式
- 选择"马"棋子
- 使用"直线无限"模板
- 取消勾选"🐴 启用蹩马腿规则"
- 勾选"可以跳过其他棋子"
- 效果：马像车一样移动且可以自由跳跃

### 2. 飞行将军
- 选择"将"棋子
- 使用"八方一格"模板
- 取消勾选"必须待在九宫内"
- 效果：将可以在全场八方移动

### 3. 自由象
- 选择"象"棋子
- 保持"象的田字"模板
- 勾选"可以过河"
- 取消勾选"🐘 启用塞象眼规则"
- 效果：象可以在全场走田字且不受阻挡

### 4. 超级兵
- 选择"兵"棋子
- 选择"↕ 兵可以横移"模板
- 勾选"可以过河"
- 效果：兵从开局就可以前进和横移

### 5. 无敌炮
- 选择"炮"棋子
- 使用"直线无限"模板
- 勾选"可以跳过其他棋子"
- 效果：炮变成可跳跃的超级车

## 🔄 界面导航

### 规则编辑器（定义阶段）
```
┌─────────────────────────────────────┐
│ ← 返回首页  自定义规则编辑器  开始对战 → │
├─────────────────────────────────────┤
│       [预设规则按钮组]                │
├──────────┬──────────────────────────┤
│          │  移动模板选择区            │
│ 棋子列表  │  [图标按钮网格]           │
│ [垂直排列]│  模板预览                 │
│          │  限制条件                 │
│          │  当前配置摘要              │
└──────────┴──────────────────────────┘
```

### 对战页面（游戏阶段）
```
┌─────────────────────────────────────┐
│ ← 返回首页  ⚙️ 修改规则  当前规则：XXX │
├─────────────────────────────────────┤
│         [规则说明卡片]                │
├─────────────────────────────────────┤
│                                     │
│           [棋盘组件]                 │
│                                     │
├─────────────────────────────────────┤
│    📋 查看详细规则配置 ▼             │
│    [可展开的规则详情]                │
└─────────────────────────────────────┘
```

## 📊 技术架构

### 文件结构
```
frontend/src/
├── pages/app/
│   ├── CustomRuleEditor.tsx  # 规则编辑页面
│   └── CustomBattle.tsx       # 自定义对战页面
├── features/chess/
│   ├── ruleEngine.ts          # 核心规则引擎
│   ├── rulePresets.ts         # 预设规则库
│   ├── moveTemplates.ts       # 移动模板系统
│   └── ruleAdapter.ts         # 格式转换适配器
```

### 数据流
```
用户操作 → 规则编辑器 → CustomRuleSet → localStorage
                                           ↓
                             读取 ← 对战页面 ← Board组件
                                           ↓
                                    ruleAdapter 转换
                                           ↓
                                      generateMoves
```

## 🎯 设计亮点

1. **模板套用**：任何棋子都可以使用任何模板
2. **界面分离**：定义和对战在两个独立页面
3. **中心布局**：按钮居中，界面简洁
4. **预览功能**：实时查看模板效果
5. **快速加载**：一键加载预设规则

## ❓ 常见问题

**Q: 如何让车走马的路线？**
A: 选择"车"棋子，点击"🐴 马的日字"模板即可。

**Q: 为什么选择兵时只有两个模板？**
A: 系统会智能过滤模板。兵有专用的移动模板（只能前进/可以横移），其他棋子不显示兵专用模板，兵也不显示其他通用模板。这样避免混淆，更符合直觉。

**Q: 蹩马腿和塞象眼规则是什么？**
A: 
- **蹩马腿**：马在日字移动的直线方向如果有棋子阻挡，就无法走那个方向
- **塞象眼**：象在田字移动的中心位置如果有棋子，就无法走那个对角
- 勾选后启用传统规则（会被阻挡），取消后可以自由移动

**Q: 如何保存自定义规则？**
A: 规则会自动保存到浏览器本地存储，刷新页面也不会丢失。

**Q: 可以创建多套规则吗？**
A: 当前版本只支持一套规则，未来会支持多套规则保存和切换。

**Q: 模板和限制条件有什么区别？**
A: 模板定义"怎么走"（移动路线），限制条件定义"能不能走"（是否允许）。

## 🚀 未来功能

- [ ] 多套规则保存和管理
- [ ] 规则分享和导入导出
- [ ] 自定义模板编辑器
- [ ] 在线对战支持自定义规则
- [ ] 规则社区和评分系统
