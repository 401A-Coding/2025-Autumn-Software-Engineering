import { useEffect, useState } from 'react'
import { useNavigate } from 'react-router-dom'
import type { PieceType } from '../../features/chess/types'
import type { CustomRuleSet, MovePattern } from '../../features/chess/ruleEngine'
import { standardChessRules } from '../../features/chess/rulePresets'
import { moveTemplates, getDefaultTemplateForPiece, type MoveTemplateType } from '../../features/chess/moveTemplates'

/**
 * å¯è§†åŒ–è§„åˆ™ç¼–è¾‘å™¨
 * é€šè¿‡åœ¨ç®€æ˜“æ£‹ç›˜ä¸Šç‚¹å‡»æ¥å®šä¹‰æ£‹å­çš„ç§»åŠ¨è§„åˆ™
 */
export default function VisualRuleEditor() {
    const navigate = useNavigate()
    
    // åˆå§‹åŒ–è§„åˆ™é›†
    const getInitialRuleSet = (): CustomRuleSet => {
        const savedRules = localStorage.getItem('customRuleSet')
        if (savedRules) {
            try {
                const loadedRules = JSON.parse(savedRules) as CustomRuleSet
                return {
                    ...loadedRules,
                    pieceRules: {
                        ...standardChessRules.pieceRules,
                        ...loadedRules.pieceRules,
                    },
                }
            } catch (e) {
                console.error('Failed to load saved rules:', e)
            }
        }
        return standardChessRules
    }
    
    const [ruleSet, setRuleSet] = useState<CustomRuleSet>(getInitialRuleSet())
    const [selectedPiece, setSelectedPiece] = useState<PieceType>('rook')
    const [selectedCells, setSelectedCells] = useState<Set<string>>(new Set())
    const [editMode, setEditMode] = useState<'add' | 'remove'>('add')
    const [moveType, setMoveType] = useState<'move' | 'capture' | 'both'>('both')
    const [isRepeatable, setIsRepeatable] = useState(false)
    const [selectedTemplate, setSelectedTemplate] = useState<MoveTemplateType | null>(null)
    const [horseLegBlocked, setHorseLegBlocked] = useState(true) // æ†‹é©¬è…¿
    const [elephantEyeBlocked, setElephantEyeBlocked] = useState(true) // å¡è±¡çœ¼
    const [cannonNeedsScreen, setCannonNeedsScreen] = useState(false) // ç‚®ç§»åŠ¨æ˜¯å¦éœ€è¦ç‚®æ¶å­

    const pieceNames: Record<PieceType, string> = {
        general: 'å°†/å¸…',
        advisor: 'å£«/ä»•',
        elephant: 'è±¡/ç›¸',
        horse: 'é©¬',
        rook: 'è½¦',
        cannon: 'ç‚®',
        soldier: 'å…µ/å’',
    }

    // æ£‹ç›˜ä¸­å¿ƒç‚¹ (ç”¨çº¢è‰²è¡¨ç¤ºæ£‹å­ä½ç½®)
    const centerRow = 4
    const centerCol = 4

    // æ ¹æ®æ¨¡æ¿è®¾ç½®é¢æ¿çŠ¶æ€ä¸æ£‹ç›˜é€‰æ‹©
    const applyTemplateToBoard = (tplId: MoveTemplateType) => {
        setSelectedTemplate(tplId)
        const tpl = moveTemplates[tplId]
        const next = new Set<string>()
        // ä»æ¨¡æ¿patternsæ¨å¯¼ä»£è¡¨æ€§æ ¼å­
        tpl.patterns.forEach(p => {
            const stepX = p.dx === 0 ? 0 : (p.dx > 0 ? 1 : -1)
            const stepY = p.dy === 0 ? 0 : (p.dy > 0 ? 1 : -1)
            if (p.repeat) {
                // å°†æ•´æ¡å°„çº¿å…¨éƒ¨é€‰ä¸­
                let r = centerRow + stepY
                let c = centerCol + stepX
                while (r >= 0 && r < 9 && c >= 0 && c < 9) {
                    next.add(`${r}-${c}`)
                    r += stepY
                    c += stepX
                }
            } else {
                const row = centerRow + p.dy
                const col = centerCol + p.dx
                if (row >= 0 && row < 9 && col >= 0 && col < 9 && !(row === centerRow && col === centerCol)) {
                    next.add(`${row}-${col}`)
                }
            }
        })
        setSelectedCells(next)
        // è®¾ç½®ç§»åŠ¨ç±»å‹ä¸å¯é‡å¤
        const hasMoveOnly = tpl.patterns.every(p => p.moveOnly)
        const hasCaptureOnly = tpl.patterns.every(p => p.captureOnly)
        if (hasMoveOnly) setMoveType('move')
        else if (hasCaptureOnly) setMoveType('capture')
        else setMoveType('both')
        setIsRepeatable(!!tpl.patterns.find(p => p.repeat))
        // é»˜è®¤æ¡ä»¶å¼€å…³
        if (tplId === 'knight-l') setHorseLegBlocked(true)
        if (tplId === 'elephant-field') setElephantEyeBlocked(true)
        // åˆ‡æ¢æ¨¡æ¿æ—¶é‡ç½®ç‚®æ¶å­å¼€å…³
        setCannonNeedsScreen(false)
    }

    // åˆæ¬¡åŠ è½½æ—¶ï¼Œä¸ºé»˜è®¤æ£‹å­åº”ç”¨é»˜è®¤æ¨¡æ¿
    useEffect(() => {
        const def = getDefaultTemplateForPiece(selectedPiece)
        applyTemplateToBoard(def)
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [])

    // é€‰æ‹©æ£‹å­æ—¶ï¼Œé¢„ç½®é»˜è®¤æ¨¡æ¿å¹¶å¡«å……æ£‹ç›˜
    const handleSelectPiece = (piece: PieceType) => {
        setSelectedPiece(piece)
        const defTpl = getDefaultTemplateForPiece(piece)
        applyTemplateToBoard(defTpl)
    }

    // ä»é€‰ä¸­çš„æ ¼å­ç”Ÿæˆç§»åŠ¨æ¨¡å¼ï¼ˆç»“åˆæ¨¡æ¿ä¸å¼€å…³ï¼‰
    const generateMovePatterns = (): MovePattern[] => {
        const patterns: MovePattern[] = []
        
        selectedCells.forEach(cellKey => {
            const [row, col] = cellKey.split('-').map(Number)
            const dx = col - centerCol
            const dy = row - centerRow
            
            if (dx === 0 && dy === 0) return // è·³è¿‡ä¸­å¿ƒç‚¹
            
            const base: MovePattern = {
                dx,
                dy,
                repeat: isRepeatable,
                maxSteps: isRepeatable ? 0 : 1,
                moveOnly: moveType === 'move',
                captureOnly: moveType === 'capture',
            }

            // æ¡ä»¶ï¼šé©¬/è±¡é˜»æŒ¡ã€ç‚®éš”å­
            if (selectedTemplate === 'knight-l' && horseLegBlocked) {
                base.conditions = [...(base.conditions || []), { type: 'path', hasNoObstacle: true }]
            }
            if (selectedTemplate === 'elephant-field' && elephantEyeBlocked) {
                base.conditions = [...(base.conditions || []), { type: 'position', hasNoObstacle: true }]
            }
            if (selectedTemplate === 'cannon-capture') {
                base.conditions = [...(base.conditions || []), { type: 'path', obstacleCount: 1 }]
            }
            if (selectedTemplate === 'cannon-move' && cannonNeedsScreen) {
                base.conditions = [...(base.conditions || []), { type: 'path', obstacleCount: 1 }]
            }

            patterns.push(base)
        })
        
        return patterns
    }

    // åº”ç”¨è§„åˆ™åˆ°é€‰ä¸­çš„æ£‹å­
    const handleApplyRule = () => {
        const patterns = generateMovePatterns()
        
        if (patterns.length === 0) {
            alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç§»åŠ¨ä½ç½®')
            return
        }
        
        setRuleSet(prev => ({
            ...prev,
            pieceRules: {
                ...prev.pieceRules,
                [selectedPiece]: {
                    name: pieceNames[selectedPiece],
                    movePatterns: patterns,
                    restrictions: prev.pieceRules[selectedPiece]?.restrictions || {},
                },
            },
        }))
        
        alert(`å·²åº”ç”¨è§„åˆ™åˆ° ${pieceNames[selectedPiece]}`)
    }

    // ä¿å­˜è§„åˆ™é›†
    const handleSaveRules = () => {
        localStorage.setItem('customRuleSet', JSON.stringify(ruleSet))
        alert('è§„åˆ™å·²ä¿å­˜ï¼')
    }

    // å¼€å§‹å¯¹å±€
    const handleStartGame = () => {
        localStorage.setItem('customRuleSet', JSON.stringify(ruleSet))
        navigate('/app/custom-battle')
    }

    // æ¸…é™¤é€‰æ‹©
    const handleClearSelection = () => {
        setSelectedCells(new Set())
    }

    // åŠ è½½å½“å‰æ£‹å­çš„è§„åˆ™åˆ°æ£‹ç›˜ä¸Š
    const handleLoadCurrentRule = () => {
        const currentRule = ruleSet.pieceRules[selectedPiece]
        if (!currentRule || !currentRule.movePatterns) {
            alert('è¯¥æ£‹å­æ²¡æœ‰è‡ªå®šä¹‰è§„åˆ™')
            return
        }

        const newSelection = new Set<string>()
        currentRule.movePatterns.forEach(pattern => {
            const stepX = pattern.dx === 0 ? 0 : (pattern.dx > 0 ? 1 : -1)
            const stepY = pattern.dy === 0 ? 0 : (pattern.dy > 0 ? 1 : -1)
            if (pattern.repeat) {
                let r = centerRow + stepY
                let c = centerCol + stepX
                while (r >= 0 && r < 9 && c >= 0 && c < 9) {
                    newSelection.add(`${r}-${c}`)
                    r += stepY
                    c += stepX
                }
            } else {
                const targetRow = centerRow + pattern.dy
                const targetCol = centerCol + pattern.dx
                if (targetRow >= 0 && targetRow < 9 && targetCol >= 0 && targetCol < 9) {
                    newSelection.add(`${targetRow}-${targetCol}`)
                }
            }
        })
        
        setSelectedCells(newSelection)
        
        // è®¾ç½®å…¶ä»–å±æ€§
        if (currentRule.movePatterns.length > 0) {
            const firstPattern = currentRule.movePatterns[0]
            setIsRepeatable(!!firstPattern.repeat)
            if (firstPattern.moveOnly) setMoveType('move')
            else if (firstPattern.captureOnly) setMoveType('capture')
            else setMoveType('both')
        }
        // æ— æ³•å¯é åæ¨æ¨¡æ¿ï¼Œæ¸…ç©ºæ¨¡æ¿é€‰ä¸­
        setSelectedTemplate(null)
    }

    // å¤„ç†æ£‹ç›˜æ ¼å­ç‚¹å‡»
    const handleCellClick = (row: number, col: number) => {
        // ä¸èƒ½ç‚¹å‡»ä¸­å¿ƒç‚¹
        if (row === centerRow && col === centerCol) return
        
        const cellKey = `${row}-${col}`
        const newSelection = new Set(selectedCells)
        
        if (editMode === 'add') {
            newSelection.add(cellKey)
        } else {
            newSelection.delete(cellKey)
        }
        
        setSelectedCells(newSelection)
    }

    // æ¸²æŸ“æ£‹ç›˜
    const renderBoard = () => {
        const rows = []
        const cellSize = 50 // æ¯ä¸ªæ ¼å­50px
        
        for (let row = 0; row < 9; row++) {
            const cells = []
            for (let col = 0; col < 9; col++) {
                const isCenter = row === centerRow && col === centerCol
                const cellKey = `${row}-${col}`
                const isSelected = selectedCells.has(cellKey)
                
                // æ ¹æ®çŠ¶æ€å†³å®šèƒŒæ™¯è‰²
                let bgColor = 'white'
                let cursor = 'pointer'
                if (isCenter) {
                    bgColor = '#ef4444' // çº¢è‰²
                    cursor = 'not-allowed'
                } else if (isSelected) {
                    bgColor = '#4ade80' // ç»¿è‰²
                }
                
                const cellStyle: React.CSSProperties = {
                    width: cellSize,
                    height: cellSize,
                    border: '1px solid #9ca3af',
                    backgroundColor: bgColor,
                    cursor: cursor,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '14px',
                    fontWeight: 'bold',
                    transition: 'all 0.2s',
                    position: 'relative',
                }
                
                cells.push(
                    <div
                        key={cellKey}
                        style={cellStyle}
                        onClick={() => !isCenter && handleCellClick(row, col)}
                        onMouseEnter={(e) => {
                            if (!isCenter && !isSelected) {
                                e.currentTarget.style.backgroundColor = '#e5e7eb'
                            }
                        }}
                        onMouseLeave={(e) => {
                            if (!isCenter && !isSelected) {
                                e.currentTarget.style.backgroundColor = 'white'
                            }
                        }}
                        title={isCenter ? 'æ£‹å­ä½ç½®' : `åç§»: (${col - centerCol}, ${row - centerRow})`}
                    >
                        {isCenter && (
                            <span style={{ color: 'white', fontSize: '16px' }}>
                                {pieceNames[selectedPiece].split('/')[0]}
                            </span>
                        )}
                        {isSelected && !isCenter && (
                            <div
                                style={{
                                    width: 24,
                                    height: 24,
                                    backgroundColor: '#2563eb',
                                    borderRadius: '50%',
                                }}
                            />
                        )}
                    </div>
                )
            }
            rows.push(
                <div key={row} style={{ display: 'flex' }}>
                    {cells}
                </div>
            )
        }
        return (
            <div style={{ 
                display: 'inline-block', 
                border: '3px solid #374151',
                boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
            }}>
                {rows}
            </div>
        )
    }

    return (
        <div style={{ 
            minHeight: '100vh', 
            background: 'linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%)',
            padding: '32px'
        }}>
            <div style={{ maxWidth: '1400px', margin: '0 auto' }}>
                {/* æ ‡é¢˜ */}
                <div style={{ marginBottom: '32px', textAlign: 'center' }}>
                    <h1 style={{ fontSize: '36px', fontWeight: 'bold', color: '#1f2937', marginBottom: '8px' }}>
                        ğŸ¨ å¯è§†åŒ–è§„åˆ™ç¼–è¾‘å™¨
                    </h1>
                    <p style={{ color: '#6b7280', fontSize: '16px' }}>åœ¨æ£‹ç›˜ä¸Šç‚¹å‡»æ¥å®šä¹‰æ£‹å­çš„ç§»åŠ¨è§„åˆ™</p>
                </div>

                <div style={{ display: 'flex', gap: '24px', flexWrap: 'wrap', justifyContent: 'center' }}>
                    {/* å·¦ä¾§ï¼šæ£‹å­é€‰æ‹© */}
                    <div style={{ flex: '0 0 300px', display: 'flex', flexDirection: 'column', gap: '16px' }}>
                        {/* æ£‹å­é€‰æ‹© */}
                            <div style={{ 
                                background: 'white', 
                                borderRadius: '8px', 
                                boxShadow: '0 4px 6px rgba(0,0,0,0.1)', 
                                padding: '20px' 
                            }}>
                                <h2 style={{ fontSize: '18px', fontWeight: 'bold', marginBottom: '16px', color: '#1f2937' }}>
                                    é€‰æ‹©æ£‹å­
                                </h2>
                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>
                                {(Object.keys(pieceNames) as PieceType[]).map(piece => (
                                    <button
                                        key={piece}
                                        onClick={() => handleSelectPiece(piece)}
                                            style={{
                                                padding: '14px',
                                                borderRadius: '8px',
                                                fontWeight: '500',
                                                fontSize: '15px',
                                                border: 'none',
                                                cursor: 'pointer',
                                                transition: 'all 0.2s',
                                                backgroundColor: selectedPiece === piece ? '#3b82f6' : '#f3f4f6',
                                                color: selectedPiece === piece ? 'white' : '#374151',
                                                transform: selectedPiece === piece ? 'scale(1.05)' : 'scale(1)',
                                                boxShadow: selectedPiece === piece ? '0 4px 6px rgba(59,130,246,0.3)' : 'none'
                                            }}
                                    >
                                        {pieceNames[piece]}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* æ¨¡æ¿é€‰æ‹© */}
                        <div style={{ 
                            background: 'white', 
                            borderRadius: '8px', 
                            boxShadow: '0 4px 6px rgba(0,0,0,0.1)', 
                            padding: '20px' 
                        }}>
                            <h2 style={{ fontSize: '18px', fontWeight: 'bold', marginBottom: '12px', color: '#1f2937' }}>
                                æ¨¡æ¿é€‰æ‹©
                            </h2>
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px' }}>
                                {(
                                    Object.keys(moveTemplates) as MoveTemplateType[]
                                )
                                    .filter(id => {
                                        // å…µç›¸å…³æ¨¡æ¿ä»…åœ¨é€‰æ‹©å…µæ—¶æ˜¾ç¤º
                                        const isPawnTemplate = id === 'pawn-forward' || id === 'pawn-cross'
                                        if (isPawnTemplate) return selectedPiece === 'soldier'
                                        return true
                                    })
                                    .map(id => (
                                    <button
                                        key={id}
                                        onClick={() => applyTemplateToBoard(id)}
                                        style={{
                                            padding: '10px',
                                            borderRadius: '8px',
                                            border: selectedTemplate === id ? '2px solid #3b82f6' : '1px solid #e5e7eb',
                                            background: selectedTemplate === id ? '#eff6ff' : 'white',
                                            textAlign: 'left',
                                            cursor: 'pointer'
                                        }}
                                        title={moveTemplates[id].description}
                                    >
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <span style={{ fontSize: '18px' }}>{moveTemplates[id].icon}</span>
                                            <span style={{ fontWeight: 600 }}>{moveTemplates[id].name}</span>
                                        </div>
                                    </button>
                                ))}
                            </div>
                            {/* ç‰¹æ®Šè§„åˆ™å¼€å…³ */}
                            {selectedTemplate === 'knight-l' && (
                                <label style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 12, cursor: 'pointer' }}>
                                    <input type="checkbox" checked={horseLegBlocked} onChange={(e) => setHorseLegBlocked(e.target.checked)} />
                                    <span>æ†‹é©¬è…¿ï¼ˆéœ€è¦é©¬è„šæ— é˜»æŒ¡ï¼‰</span>
                                </label>
                            )}
                            {selectedTemplate === 'elephant-field' && (
                                <label style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 8, cursor: 'pointer' }}>
                                    <input type="checkbox" checked={elephantEyeBlocked} onChange={(e) => setElephantEyeBlocked(e.target.checked)} />
                                    <span>å¡è±¡çœ¼ï¼ˆéœ€è¦è±¡çœ¼æ— é˜»æŒ¡ï¼‰</span>
                                </label>
                            )}
                            {selectedTemplate === 'cannon-move' && (
                                <label style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 8, cursor: 'pointer' }}>
                                    <input type="checkbox" checked={cannonNeedsScreen} onChange={(e) => setCannonNeedsScreen(e.target.checked)} />
                                    <span>ç‚®ç§»åŠ¨éœ€è¦ç‚®æ¶å­ï¼ˆè·¯å¾„ä¸Šéœ€æœ‰1ä¸ªéšœç¢ï¼‰</span>
                                </label>
                            )}
                        </div>

                        {/* ç¼–è¾‘æ¨¡å¼ */}
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-bold mb-4 text-gray-800">ç¼–è¾‘æ¨¡å¼</h2>
                            <div className="space-y-3">
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setEditMode('add')}
                                        className={`flex-1 p-3 rounded-lg font-medium transition-all ${
                                            editMode === 'add'
                                                ? 'bg-green-500 text-white'
                                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                        }`}
                                    >
                                        â• æ·»åŠ 
                                    </button>
                                    <button
                                        onClick={() => setEditMode('remove')}
                                        className={`flex-1 p-3 rounded-lg font-medium transition-all ${
                                            editMode === 'remove'
                                                ? 'bg-red-500 text-white'
                                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                        }`}
                                    >
                                        â– åˆ é™¤
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* ç§»åŠ¨ç±»å‹ */}
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-bold mb-4 text-gray-800">ç§»åŠ¨ç±»å‹</h2>
                            <div className="space-y-2">
                                <label className="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input
                                        type="radio"
                                        name="moveType"
                                        checked={moveType === 'both'}
                                        onChange={() => setMoveType('both')}
                                        className="w-4 h-4"
                                    />
                                    <span>ç§»åŠ¨å’Œåƒå­</span>
                                </label>
                                <label className="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input
                                        type="radio"
                                        name="moveType"
                                        checked={moveType === 'move'}
                                        onChange={() => setMoveType('move')}
                                        className="w-4 h-4"
                                    />
                                    <span>ä»…ç§»åŠ¨</span>
                                </label>
                                <label className="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input
                                        type="radio"
                                        name="moveType"
                                        checked={moveType === 'capture'}
                                        onChange={() => setMoveType('capture')}
                                        className="w-4 h-4"
                                    />
                                    <span>ä»…åƒå­</span>
                                </label>
                            </div>
                        </div>

                        {/* é«˜çº§é€‰é¡¹å·²ç§»é™¤ï¼Œé‡å¤ä¸å…¶ä»–å±æ€§ç”±æ¨¡æ¿å†³å®š */}

                        {/* æ“ä½œæŒ‰é’® */}
                        <div className="bg-white rounded-lg shadow-lg p-6 space-y-3">
                            <button
                                onClick={handleLoadCurrentRule}
                                className="w-full bg-purple-500 text-white px-4 py-3 rounded-lg hover:bg-purple-600 transition-colors font-medium"
                            >
                                ğŸ“¥ åŠ è½½å½“å‰è§„åˆ™
                            </button>
                            <button
                                onClick={handleClearSelection}
                                className="w-full bg-gray-500 text-white px-4 py-3 rounded-lg hover:bg-gray-600 transition-colors font-medium"
                            >
                                ğŸ—‘ï¸ æ¸…é™¤é€‰æ‹©
                            </button>
                            <button
                                onClick={handleApplyRule}
                                className="w-full bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium"
                            >
                                âœ… åº”ç”¨è§„åˆ™
                            </button>
                        </div>
                    </div>

                    {/* ä¸­é—´ï¼šæ£‹ç›˜ */}
                    <div style={{ flex: '1 1 600px', minWidth: '600px' }}>
                        <div style={{ 
                            background: 'white', 
                            borderRadius: '12px', 
                            boxShadow: '0 10px 15px rgba(0,0,0,0.1)', 
                            padding: '24px' 
                        }}>
                            <div style={{ marginBottom: '24px', textAlign: 'center' }}>
                                <h2 style={{ fontSize: '24px', fontWeight: 'bold', color: '#1f2937', marginBottom: '8px' }}>
                                    ç¼–è¾‘è§„åˆ™ï¼š{pieceNames[selectedPiece]}
                                </h2>
                                <p style={{ color: '#6b7280', fontSize: '15px' }}>
                                    å·²é€‰æ‹© <span style={{ fontWeight: 'bold', color: '#3b82f6' }}>{selectedCells.size}</span> ä¸ªä½ç½®
                                </p>
                            </div>
                            
                            {/* æ£‹ç›˜ */}
                            <div style={{ display: 'flex', justifyContent: 'center', marginBottom: '24px' }}>
                                {renderBoard()}
                            </div>

                            {/* è¯´æ˜ */}
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2">
                                <h3 className="font-bold text-blue-800">ä½¿ç”¨è¯´æ˜ï¼š</h3>
                                <ul className="text-sm text-blue-700 space-y-1">
                                    <li>â€¢ <span className="font-medium">çº¢è‰²æ ¼å­</span>ï¼šå½“å‰æ£‹å­ä½ç½®ï¼ˆä¸å¯é€‰ï¼‰</li>
                                    <li>â€¢ <span className="font-medium">ç»¿è‰²æ ¼å­</span>ï¼šå·²é€‰æ‹©çš„ç§»åŠ¨ä½ç½®</li>
                                    <li>â€¢ <span className="font-medium">ç‚¹å‡»æ ¼å­</span>ï¼šæ·»åŠ /åˆ é™¤ç§»åŠ¨ä½ç½®</li>
                                    <li>â€¢ <span className="font-medium">è“è‰²åœ†ç‚¹</span>ï¼šæ ‡è®°å¯ç§»åŠ¨åˆ°çš„ä½ç½®</li>
                                    <li>â€¢ é€‰æ‹©æ¨¡æ¿åï¼Œè§„åˆ™ä¼šè‡ªåŠ¨å¸¦ä¸Šå¯é‡å¤/åƒå­ç­‰å±æ€§</li>
                                </ul>
                            </div>

                            {/* åº•éƒ¨æ“ä½œ */}
                            <div className="mt-6 flex gap-4">
                                <button
                                    onClick={handleSaveRules}
                                    className="flex-1 bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors font-medium text-lg"
                                >
                                    ğŸ’¾ ä¿å­˜æ‰€æœ‰è§„åˆ™
                                </button>
                                <button
                                    onClick={handleStartGame}
                                    className="flex-1 bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600 transition-colors font-medium text-lg"
                                >
                                    â–¶ï¸ å¼€å§‹å¯¹å±€
                                </button>
                                <button
                                    onClick={() => navigate('/app/home')}
                                    className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors font-medium"
                                >
                                    è¿”å›
                                </button>
                            </div>
                        </div>

                        {/* å½“å‰è§„åˆ™é¢„è§ˆå·²æŒ‰éœ€ç§»é™¤ */}
                    </div>
                </div>
            </div>
        </div>
    )
}
